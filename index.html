<!DOCTYPE html>
<html>
<head>
    <title>Shop Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Black+Ops+One&family=Bungee&family=Creepster&family=Fira+Sans+Extra+Condensed:wght@800&family=Graduate&family=Kenia&family=Luckiest+Guy&family=Metal+Mania&family=Monoton&family=Nosifer&family=Orbitron:wght@400;900&family=Oswald:wght@700&family=Permanent+Marker&family=Press+Start+2P&family=Racing+Sans+One&family=Righteous&family=Roboto+Condensed:wght@700&family=Russo+One&family=Share+Tech+Mono&family=Shojumaru&family=Special+Elite&family=Staatliches&family=Teko:wght@600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body { background: #050505; color: #ffffff; font-family: 'Segoe UI', sans-serif; display: flex; padding: 15px; gap: 15px; margin: 0; overflow-x: hidden; }
        #controls { width: 380px; background: #1a1a1a; padding: 15px; border-radius: 10px; border: 1px solid #0055ff; height: 95vh; overflow-y: auto; font-size: 11px; }
        input[type="text"], select, textarea { width: 100%; background: #000; border: 1px solid #333; color: white; padding: 5px; margin-bottom: 5px; border-radius: 4px; font-family: inherit; }
        textarea { height: 60px; resize: vertical; }
        .stat-input-row { display: grid; grid-template-columns: 1.5fr 1fr; gap: 5px; margin-bottom: 5px; }
        
        #poster-container { position: relative; width: 1000px; height: 562px; background: #000 center/cover no-repeat; overflow: hidden; border: none; margin: 0; padding: 0; flex-shrink: 0; }
        #bg-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); pointer-events: none; z-index: 1; }
        
        #v-guide { position: absolute; left: 50%; top: 0; bottom: 0; width: 1px; background: rgba(255, 255, 255, 0.4); z-index: 100; display: none; pointer-events: none; }
        #h-guide { position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: rgba(255, 255, 255, 0.4); z-index: 100; display: none; pointer-events: none; }

        .headline, .footer-text { position: absolute; width: auto; text-align: center; font-weight: 900; text-transform: uppercase; z-index: 11; letter-spacing: 5px; cursor: move; white-space: pre-wrap; line-height: 1.2; transform-origin: center; }
        .stats-overlay { position: absolute; left: 40px; top: 110px; z-index: 10; cursor: move; padding: 10px; border: 1px solid transparent; transform-origin: top left; }
        .draggable-img { position: absolute; cursor: move; z-index: 5; filter: drop-shadow(0 0 15px rgba(0,0,0,0.4)); transform-origin: center; }
        
        .active-el { border: 1px dashed #ffffff !important; }
        .header-row { display: grid; grid-template-columns: 140px 80px 80px; gap: 5px; padding-left: 5px; margin-bottom: 5px; font-size: 10px; text-transform: uppercase; font-weight: bold; pointer-events: none; }
        .stat-line-wrapper { display: grid; grid-template-columns: 140px 80px 80px; gap: 5px; margin-bottom: 5px; pointer-events: none; }
        
        .box-main, .box-base, .box-mut { border: 1px solid #0055ff; padding: 6px 10px; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(2px); color: #fff; }
        .box-main { justify-content: flex-start; border-left-width: 4px; }
        .val-name, .base-val, .mut-val { font-weight: bold; }
        
        button { width: 100%; padding: 10px; background: #002244; color: #ffffff; border: 1px solid #0055ff; cursor: pointer; margin: 5px 0; border-radius: 4px; font-weight: bold; }
        .btn-row { display: flex; gap: 5px; }
        input[type="range"] { width: 100%; accent-color: #0055ff; cursor: pointer; margin-bottom: 10px; }
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        hr { border: 0.5px solid #333; margin: 15px 0; }
        #openFileInput { display: none; }
    </style>
</head>
<body>
    <div id="controls">
        <h3>Shop Tool</h3>
        <label>PC STORAGE</label>
        <div class="save-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <button onclick="saveProjectFile()">SAVE PROJECT</button>
            <button onclick="$('openFileInput').click()">OPEN PROJECT</button>
            <input type="file" id="openFileInput" accept=".json" onchange="loadProjectFile(event)">
        </div>
        <hr>
        <label>1. TEMPLATE BACKGROUND</label>
        <input type="file" id="bgL">
        <label>DARKEN BACKGROUND</label>
        <input type="range" id="dark" min="0" max="100" value="30">
        <hr>
        <label>ALIGNMENT & TRANSFORMS</label>
        <div class="btn-row">
            <button onclick="autoCenterEl()">AUTO-CENTER</button>
            <button onclick="toggleGuides()">GUIDES</button>
        </div>
        <div class="btn-row">
            <button onclick="flipImage()">FLIP IMAGE</button>
            <button onclick="resetRotation()" style="color:#ffcc00">RESET ROT</button>
        </div>
        <label>ROTATE ELEMENT</label>
        <input type="range" id="rotSlider" min="-180" max="180" value="0">
        <hr>
        <div class="color-grid">
            <div><label>UI Blue</label><input type="color" id="clrUI" value="#0055ff"></div>
            <div><label>Box Blue</label><input type="color" id="clrBox" value="#001133"></div>
            <div><label>Head Red</label><input type="color" id="clrHead" value="#ff0000"></div>
            <div><label>Foot White</label><input type="color" id="clrFoot" value="#ffffff"></div>
            <div><label>Shadow</label><input type="color" id="clrShadow" value="#000000"></div>
        </div>
        <div class="color-grid">
            <div><label>Intensity</label><input type="range" id="shInt" min="0" max="50" value="15"></div>
            <div><label>Blur</label><input type="range" id="shBlur" min="0" max="50" value="15"></div>
        </div>
        <hr>
        <label>FONT STYLE (FULL 25+ LIBRARY)</label>
        <select id="fontSelect">
            <optgroup label="Industrial & Bold">
                <option value="'Bebas Neue', cursive">Bebas Neue</option>
                <option value="'Staatliches', cursive">Staatliches</option>
                <option value="'Anton', sans-serif">Anton</option>
                <option value="'Oswald', sans-serif">Oswald</option>
                <option value="'Graduate', serif">Graduate</option>
            </optgroup>
            <optgroup label="Military & Tech">
                <option value="'Black Ops One', cursive">Black Ops One</option>
                <option value="'Orbitron', sans-serif">Orbitron</option>
                <option value="'Share Tech Mono', monospace">Share Tech Mono</option>
                <option value="'Teko', sans-serif">Teko</option>
                <option value="'Kenia', cursive">Kenia</option>
            </optgroup>
            <optgroup label="Gaming & Style">
                <option value="'Righteous', cursive">Righteous</option>
                <option value="'Russo One', sans-serif">Russo One</option>
                <option value="'Luckiest Guy', cursive">Luckiest Guy</option>
                <option value="'Bungee', cursive">Bungee</option>
                <option value="'Racing Sans One', cursive">Racing Sans</option>
                <option value="'Press Start 2P', cursive">Retro Pixel</option>
            </optgroup>
            <optgroup label="Horror">
                <option value="'Nosifer', cursive">Nosifer</option>
                <option value="'Creepster', cursive">Creepster</option>
                <option value="'Metal Mania', cursive">Metal Mania</option>
                <option value="'Shojumaru', cursive">Shojumaru</option>
            </optgroup>
            <option value="'Segoe UI', sans-serif">Segoe UI</option>
        </select>
        <hr>
        <label>ELEMENT SIZE</label><input type="range" id="fSize" min="5" max="500" value="100">
        <label>STATS FONT SIZE</label><input type="range" id="sSize" min="5" max="30" value="15">
        <hr>
        <label>2. ADD CREATURE IMAGES</label>
        <input type="file" id="imgL" multiple>
        <div class="btn-row">
            <button onclick="changeZ(1)">FRONT</button>
            <button onclick="changeZ(-1)">BACK</button>
            <button onclick="deleteEl()" style="color:#ff3366">DELETE</button>
        </div>
        <hr>
        <label>HEADLINE</label><textarea id="hIn">FOR SALE</textarea>
        <label>FOOTER</label><textarea id="fIn">CONTACT: GRAVESTULLUK</textarea>
        <div id="input-fields"></div>
        <hr>
        <button onclick="downloadPoster()" style="background: #ffffff; color: #000; border: 2px solid #0055ff;">DOWNLOAD PNG</button>
    </div>

    <div id="poster-container">
        <div id="v-guide"></div><div id="h-guide"></div>
        <div id="bg-overlay"></div>
        <div class="headline" id="hOut" style="top:25px; left:400px; text-shadow: 0 0 15px #000000; color:#ff0000; font-family:'Bebas Neue'; font-size: 60px;">FOR SALE</div>
        <div id="img-holder"></div>
        <div class="stats-overlay" id="ui">
            <div class="header-row" id="hRow"><span>Stat / Value</span><span style="text-align:center">Base</span><span style="text-align:center">Muts</span></div>
            <div id="stat-rows"></div>
        </div>
        <div class="footer-text" id="fOut" style="bottom:25px; left:400px; text-shadow: 0 0 15px #000000; color:#ffffff; font-family:'Bebas Neue'; font-size: 30px;">CONTACT: GRAVESTULLUK</div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        const defaultNames = ["HEALTH", "STAMINA", "OXYGEN", "FOOD", "WEIGHT", "MELEE", "SPEED"];
        const defaultBases = ["15000", "2000", "150", "8000", "1200", "600%", "100%"];

        let inputHtml = '';
        let rowsHtml = '';
        for(let i=0; i<7; i++) {
            inputHtml += `<div class="stat-input-row"><input type="text" class="refresh-input" id="n${i}" value="${defaultNames[i]} 0"><input type="text" class="refresh-input" id="b${i}" value="${defaultBases[i]}"></div>`;
            rowsHtml += `<div class="stat-line-wrapper"><div class="box-main" id="bm${i}"><span class="val-name" id="ln${i}"></span></div><div class="box-base" id="bb${i}"><span class="base-val" id="lb${i}"></span></div><div class="box-mut" id="bx${i}"><span class="mut-val">${(i===6)?'N/A':'255'}</span></div></div>`;
        }
        $('input-fields').innerHTML = inputHtml;
        $('stat-rows').innerHTML = rowsHtml;

        const refreshAll = () => {
            $('hOut').innerText = $('hIn').value;
            $('fOut').innerText = $('fIn').value;
            for(let i=0; i<7; i++) { if($('ln'+i)) $('ln'+i).innerText = $('n'+i).value; if($('lb'+i)) $('lb'+i).innerText = $('b'+i).value; }
        };

        let activeEl = null, drag = false, sx, sy;

        function applyTransforms(el) {
            if (!el) return;
            const rot = el.dataset.rot || 0;
            const flip = el.dataset.flip || 1;
            const scale = el.id === 'ui' ? (parseInt($('fSize').value) / 100) : 1;
            el.style.transform = `rotate(${rot}deg) scaleX(${flip}) ${el.id==='ui' ? `scale(${scale})` : ''}`;
        }

        function makeDraggable(el) {
            el.onmousedown = e => {
                if(activeEl) activeEl.classList.remove('active-el');
                activeEl = el; activeEl.classList.add('active-el');
                $('rotSlider').value = el.dataset.rot || 0;
                drag = true; sx = e.clientX - el.offsetLeft; sy = e.clientY - el.offsetTop;
                e.preventDefault(); e.stopPropagation();
            };
        }

        makeDraggable($('hOut')); makeDraggable($('fOut')); makeDraggable($('ui'));
        window.onmousemove = e => { if(drag && activeEl) { activeEl.style.left = (e.clientX - sx) + 'px'; activeEl.style.top = (e.clientY - sy) + 'px'; }};
        window.onmouseup = () => drag = false;

        $('rotSlider').oninput = () => { if(activeEl) { activeEl.dataset.rot = $('rotSlider').value; applyTransforms(activeEl); }};
        function resetRotation() { if(activeEl) { activeEl.dataset.rot = 0; $('rotSlider').value = 0; applyTransforms(activeEl); }};
        function flipImage() { if(activeEl && activeEl.tagName === 'IMG') { activeEl.dataset.flip = (activeEl.dataset.flip || 1) * -1; applyTransforms(activeEl); }};
        function toggleGuides() { const d = $('v-guide').style.display === 'block' ? 'none' : 'block'; $('v-guide').style.display = $('h-guide').style.display = d; }
        function autoCenterEl() { if(activeEl) activeEl.style.left = (1000/2 - activeEl.offsetWidth/2) + "px"; }

        $('fontSelect').onchange = () => { const f = $('fontSelect').value; $('hOut').style.fontFamily = f; $('fOut').style.fontFamily = f; };
        $('bgL').onchange = e => { const r = new FileReader(); r.onload = ev => $('poster-container').style.backgroundImage = `url(${ev.target.result})`; r.readAsDataURL(e.target.files[0]); };
        $('imgL').onchange = e => {
            Array.from(e.target.files).forEach(file => {
                const r = new FileReader();
                r.onload = ev => {
                    const img = document.createElement('img');
                    img.src = ev.target.result; img.className = 'draggable-img';
                    img.style.width = '300px'; img.style.left = '450px'; img.style.top = '100px'; img.style.zIndex = 5;
                    img.dataset.rot = 0; img.dataset.flip = 1;
                    makeDraggable(img); $('img-holder').appendChild(img);
                };
                r.readAsDataURL(file);
            });
        };

        $('fSize').oninput = () => {
            if(!activeEl) return;
            const val = $('fSize').value;
            if(activeEl.tagName === 'IMG') activeEl.style.width = (val * 4) + 'px';
            else if(activeEl.id === 'ui') applyTransforms(activeEl);
            else activeEl.style.fontSize = val + 'px';
        };

        const updateColors = () => {
            const ui = $('clrUI').value, box = $('clrBox').value, sh = $('clrShadow').value, si = $('shInt').value, sb = $('shBlur').value;
            document.querySelectorAll('.box-main, .box-base, .box-mut').forEach(b => { b.style.borderColor = ui; b.style.backgroundColor = box + 'B3'; });
            document.querySelectorAll('.val-name, .base-val, .mut-val').forEach(n => n.style.color = ui);
            $('hRow').style.color = ui; $('hOut').style.color = $('clrHead').value; $('fOut').style.color = $('clrFoot').value;
            $('hOut').style.textShadow = `0 0 ${sb}px ${sh}, 0 0 ${si}px ${sh}`; $('fOut').style.textShadow = `0 0 ${sb}px ${sh}, 0 0 ${si}px ${sh}`;
        };

        ['clrUI', 'clrBox', 'clrHead', 'clrFoot', 'clrShadow', 'shInt', 'shBlur'].forEach(id => $(id).oninput = updateColors);

        function downloadPoster() {
            if(activeEl) activeEl.classList.remove('active-el');
            $('v-guide').style.display = $('h-guide').style.display = 'none';
            html2canvas($("poster-container"), { 
                scale: 2, width: 1000, height: 562, scrollX: -window.scrollX, scrollY: -window.scrollY, 
                windowWidth: document.documentElement.offsetWidth, windowHeight: document.documentElement.offsetHeight, x: 0, y: 0 
            }).then(canvas => {
                let link = document.createElement('a');
                link.download = 'Shop_Tool_Poster.png';
                link.href = canvas.toDataURL("image/png"); link.click();
            });
        }

        function saveProjectFile() {
            const settings = {};
            document.querySelectorAll('#controls input, #controls textarea, #controls select').forEach(el => { if(el.id && el.type !== 'file') settings[el.id] = el.value; });
            const layout = {
                hOut: { left: $('hOut').style.left, top: $('hOut').style.top, fontSize: $('hOut').style.fontSize, rot: $('hOut').dataset.rot, family: $('hOut').style.fontFamily },
                fOut: { left: $('fOut').style.left, top: $('fOut').style.top, fontSize: $('fOut').style.fontSize, rot: $('fOut').dataset.rot, family: $('fOut').style.fontFamily },
                ui: { left: $('ui').style.left, top: $('ui').style.top, transform: $('ui').style.transform, rot: $('ui').dataset.rot }
            };
            const blob = new Blob([JSON.stringify({ settings, layout }, null, 2)], {type: "application/json"});
            const url = URL.createObjectURL(blob), a = document.createElement('a'); a.href = url; a.download = `Shop_Tool_Project.json`; a.click(); URL.revokeObjectURL(url);
        }

        function loadProjectFile(event) {
            const reader = new FileReader();
            reader.onload = e => {
                const data = JSON.parse(e.target.result);
                for (let id in data.settings) { if ($(id)) $(id).value = data.settings[id]; }
                for (let id in data.layout) { const el = $(id), dat = data.layout[id]; if (el) { el.style.left = dat.left; el.style.top = dat.top; el.dataset.rot = dat.rot || 0; if (dat.fontSize) el.style.fontSize = dat.fontSize; if (dat.family) el.style.fontFamily = dat.family; if (dat.transform) el.style.transform = dat.transform; } }
                refreshAll(); updateColors();
            };
            reader.readAsText(event.target.files[0]);
        }
        document.querySelectorAll('.refresh-input, textarea').forEach(i => i.addEventListener('input', refreshAll));
        const deleteEl = () => { if(activeEl && activeEl.tagName === 'IMG') activeEl.remove(); };
        const changeZ = (v) => { if(activeEl) activeEl.style.zIndex = (parseInt(activeEl.style.zIndex)||5) + v; };
        refreshAll(); updateColors();
    </script>
</body>
</html>
